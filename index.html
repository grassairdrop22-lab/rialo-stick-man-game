<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rialo Stickman Dynamic Enemies</title>
<style>
body{margin:0;padding:0;background:#111;font-family:sans-serif;}
canvas{display:block;margin:0 auto;background:#111;}
.controls{position:absolute;top:10px;right:10px;z-index:2;}
button{margin-left:5px;padding:6px 12px;background:#333;color:#0ff;border:none;border-radius:5px;cursor:pointer;}
.message,.next-level,.retry{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:#0ff;padding:20px 40px;font-size:1.5em;border-radius:12px;display:none;text-align:center;}
.btn-next,.btn-retry{margin-top:15px;padding:8px 25px;background:#0ff;border:none;border-radius:8px;color:#111;cursor:pointer;}
</style>
</head>
<body>
<div class="controls">
<button id="playBtn">Play</button>
<button id="pauseBtn">Pause</button>
<button id="restartBtn">Restart</button>
</div>
<canvas id="game" width="900" height="480"></canvas>
<div class="next-level" id="nextLevel">
<span>Level Completed!</span><br>
<button class="btn-next" id="btnNext">Next Level</button>
</div>
<div class="retry" id="retry">
<span>You Lost!</span><br>
<button class="btn-retry" id="btnRetry">Retry</button>
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let player, enemies, bullets, keys, gameActive=false, gamePaused=false, level=1;

// reset game
function reset(levelUp=false){
    player = {x:100, y:350, w:32, h:68, color:"#0ff", hp:100, maxHp:100, gunCD:0, bulletSpeed:7+level};
    enemies = [];
    let enemyCount = level + 1; // multiple enemies
    for(let i=0;i<enemyCount;i++){
        enemies.push({
            x:500 + i*60, y:350, w:32, h:68, color:"#f0f", hp:80+(level-1)*30, maxHp:80+(level-1)*30,
            speed:1.5+(level-1)*0.3, damage:20+(level-1)*5, gunCD:0, alive:true,
            dodgeCD: Math.floor(Math.random()*100) // cooldown for dodge
        });
    }
    bullets = [];
    keys = {};
    gameActive = true;
    gamePaused = false;
    document.getElementById('nextLevel').style.display="none";
    document.getElementById('retry').style.display="none";
}

// draw stickman
function drawStickman(p,gun=false){
    ctx.strokeStyle=p.color; ctx.lineWidth=4;
    ctx.beginPath();
    ctx.arc(p.x+16,p.y+14,14,0,Math.PI*2);
    ctx.moveTo(p.x+16,p.y+28); ctx.lineTo(p.x+16,p.y+55);
    ctx.moveTo(p.x+16,p.y+32); ctx.lineTo(p.x-4,p.y+43);
    ctx.moveTo(p.x+16,p.y+32); ctx.lineTo(p.x+36,p.y+43);
    ctx.moveTo(p.x+16,p.y+55); ctx.lineTo(p.x+4,p.y+80);
    ctx.moveTo(p.x+16,p.y+55); ctx.lineTo(p.x+28,p.y+80);
    ctx.stroke();
    if(gun){ ctx.fillStyle="#fff"; ctx.fillRect(p.x+34,p.y+36,15,6); }
}

// draw bullets
function drawBullet(b){ ctx.font='bold 16px monospace'; ctx.fillStyle="#0ff"; ctx.fillText('Rialo', b.x, b.y); }

// draw HP
function drawHP(p){ ctx.fillStyle="#222"; ctx.fillRect(p.x-6,p.y-22,54,11); ctx.fillStyle="#0f0"; ctx.fillRect(p.x-6,p.y-22,54*p.hp/p.maxHp,11); ctx.strokeStyle="#fff"; ctx.strokeRect(p.x-6,p.y-22,54,11); }

// update game
function update(){
    if(!gameActive || gamePaused) return;

    // player movement
    if(keys['ArrowLeft']) player.x = Math.max(0, player.x-4);
    if(keys['ArrowRight']) player.x = Math.min(canvas.width-32, player.x+4);
    if(keys['ArrowUp'] && player.y>300) player.y-=9;
    if(player.y<350) player.y+=5;

    // player shooting
    if(keys[' '] && player.gunCD<0){
        bullets.push({x:player.x+50, y:player.y+36, dx:player.bulletSpeed, dy:0, from:'player'});
        player.gunCD=25;
    }
    if(keys['z'] && player.gunCD<0){
        bullets.push({x:player.x-10, y:player.y+36, dx:-player.bulletSpeed, dy:0, from:'player'});
        player.gunCD=25;
    }
    player.gunCD--;

    // enemy AI with dynamic dodging
    enemies.forEach(e=>{
        if(!e.alive) return;
        // move toward player
        if(player.x>e.x) e.x += e.speed; else e.x -= e.speed;

        // random dodge
        if(e.dodgeCD <= 0){
            let dodgeDir = Math.random() < 0.5 ? -1 : 1;
            e.x += dodgeDir * (2 + Math.random()*2);
            e.dodgeCD = 50 + Math.random()*50; // reset dodge cooldown
        } else e.dodgeCD--;

        // enemy shooting
        if(Math.abs(player.x-e.x)<200 && Math.random()<0.02 && e.gunCD<0){
            bullets.push({x:e.x, y:e.y+34, dx:(player.x<e.x?-5:5), dy:0, from:'enemy'});
            e.gunCD=45;
        }
        e.gunCD--;
    });

    // bullets movement & hit detection
    for(let i=bullets.length-1;i>=0;i--){
        let b = bullets[i]; b.x+=b.dx; b.y+=b.dy;
        if(b.from==='player'){
            enemies.forEach(e=>{
                if(e.alive && b.x>e.x && b.x<e.x+32 && b.y>e.y && b.y<e.y+80){
                    e.hp-=18+level*2; if(e.hp<=0) e.alive=false;
                    bullets.splice(i,1);
                }
            });
        } else if(b.from==='enemy'){
            if(b.x>player.x && b.x<player.x+32 && b.y>player.y && b.y<player.y+80){
                player.hp -=20; bullets.splice(i,1);
            }
        }
        if(b.x<0 || b.x>canvas.width) bullets.splice(i,1);
    }

    // check win/lose
    if(player.hp<=0) lose();
    let allDead = enemies.every(e=>!e.alive);
    if(allDead) win();
}

// win/lose
function win(){ gameActive=false; document.getElementById('nextLevel').style.display="block"; }
function lose(){ gameActive=false; document.getElementById('retry').style.display="block"; }

// draw everything
function draw(){
    ctx.fillStyle="#111"; ctx.fillRect(0,0,canvas.width,canvas.height);
    drawStickman(player,true); drawHP(player);
    enemies.forEach(e=>{ if(e.alive){ drawStickman(e); drawHP(e); } });
    bullets.forEach(drawBullet);
    ctx.fillStyle="#0ff"; ctx.font="bold 16px Arial";
    ctx.fillText("← → move, ↑ jump, Space shoot right, Z shoot left",20,20);
    ctx.fillText("Level: "+level,20,40);
}

// game loop
function gameLoop(){ update(); draw(); requestAnimationFrame(gameLoop); }

// controls
document.getElementById('playBtn').onclick = ()=>gamePaused=false;
document.getElementById('pauseBtn').onclick = ()=>gamePaused=true;
document.getElementById('restartBtn').onclick = ()=>{ level=1; reset(); };
document.getElementById('btnNext').onclick = ()=>{ level+=1; reset(true); };
document.getElementById('btnRetry').onclick = ()=>reset();
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);

reset(); gameLoop();
</script>
</body>
</html>
